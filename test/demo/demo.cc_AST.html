<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>AST_Visualization</title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<style>
		.node circle {
			fill: #fff;
			stroke: black;
			stroke-width: 1.0px;
		}

		.node text {
			font-size: 5px;
			color: black;
		}

		.link {
			fill: none;
			stroke: black;
			stroke-width: 1.0px;
		}
	</style>
</head>

<body>
	<script>
		var width = 3000;
		var height = 3000;
		//区域宽高
		var svg = d3.select('body')
			.append('svg')
			.attr('width', width)
			.attr('height', height)
			.append('g')
			.attr('transform', 'translate(50,0)')
		//树尺寸
		var tree = d3.layout.tree()
			.size([width, height - 2000])

		//对角线
		var diagonal = d3.svg.diagonal()
			.projection(d => [d.y, d.x])
		//请求数据
		var root = { "name" : "Program", "children" : [ { "name" : "FuncDeclaration", "children" : [ { "name" : "Return Type", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }  ] }, { "name" : "Function Name", "children" : [ { "name" : "printf" }  ] }, { "name" : "ArgList", "children" : [ { "name" : "Arg", "children" : [ { "name" : "PointerType", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Char" }  ] }  ] }  ] }, { "name" : "...", "children" : [   ] }  ] }  ] }, { "name" : "FuncDeclaration", "children" : [ { "name" : "Return Type", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }  ] }, { "name" : "Function Name", "children" : [ { "name" : "scanf" }  ] }, { "name" : "ArgList", "children" : [ { "name" : "Arg", "children" : [ { "name" : "PointerType", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Char" }  ] }  ] }  ] }, { "name" : "...", "children" : [   ] }  ] }  ] }, { "name" : "TypeDeclaration", "children" : [ { "name" : "StructType", "children" : [ { "name" : "FieldDecl", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }, { "name" : "MemList", "children" : [ { "name" : "x" }  ] }  ] }  ] }, { "name" : "Point" }  ] }, { "name" : "TypeDeclaration", "children" : [ { "name" : "StructType", "children" : [ { "name" : "FieldDecl", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }, { "name" : "MemList", "children" : [ { "name" : "x" }  ] }  ] }  ] }, { "name" : "Student" }  ] }, { "name" : "FuncDeclaration", "children" : [ { "name" : "Return Type", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Void" }  ] }  ] }, { "name" : "Function Name", "children" : [ { "name" : "SetX" }  ] }, { "name" : "ArgList", "children" : [ { "name" : "Arg", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }, { "name" : "x" }  ] }  ] }, { "name" : "FuncBody", "children" : [ { "name" : "DirectAssign", "children" : [ { "name" : "StructDereference", "children" : [ { "name" : "This", "children" : [ { "name" : "this" }  ] }, { "name" : "x" }  ] }, { "name" : "Variable", "children" : [ { "name" : "x" }  ] }  ] }, { "name" : "ReturnStmt", "children" : [  ] }  ] }  ] }, { "name" : "FuncDeclaration", "children" : [ { "name" : "Return Type", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }  ] }, { "name" : "Function Name", "children" : [ { "name" : "GetX" }  ] }, { "name" : "ArgList", "children" : [  ] }, { "name" : "FuncBody", "children" : [ { "name" : "ReturnStmt", "children" : [ { "name" : "StructDereference", "children" : [ { "name" : "This", "children" : [ { "name" : "this" }  ] }, { "name" : "x" }  ] }  ] }  ] }  ] }, { "name" : "FuncDeclaration", "children" : [ { "name" : "Return Type", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Void" }  ] }  ] }, { "name" : "Function Name", "children" : [ { "name" : "PrintX" }  ] }, { "name" : "ArgList", "children" : [  ] }, { "name" : "FuncBody", "children" : [ { "name" : "FunctionCall", "children" : [ { "name" : "Function Name", "children" : [ { "name" : "printf" }  ] }, { "name" : "ArgList", "children" : [ { "name" : "Global String", "children" : [ { "name" : "\"Point\\\'s x = %d\\n\"" }  ] }, { "name" : "StructDereference", "children" : [ { "name" : "This", "children" : [ { "name" : "this" }  ] }, { "name" : "x" }  ] }  ] }  ] }, { "name" : "ReturnStmt", "children" : [  ] }  ] }  ] }, { "name" : "FuncDeclaration", "children" : [ { "name" : "Return Type", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }  ] }, { "name" : "Function Name", "children" : [ { "name" : "main" }  ] }, { "name" : "ArgList", "children" : [  ] }, { "name" : "FuncBody", "children" : [ { "name" : "VarDeclaration", "children" : [ { "name" : "Definedtype", "children" : [ { "name" : "Point" }  ] }, { "name" : "VarList", "children" : [ { "name" : "Varinit", "children" : [ { "name" : "p" }  ] }  ] }  ] }, { "name" : "VarDeclaration", "children" : [ { "name" : "PointerType", "children" : [ { "name" : "Definedtype", "children" : [ { "name" : "Point" }  ] }  ] }, { "name" : "VarList", "children" : [ { "name" : "Varinit", "children" : [ { "name" : "pp" }, { "name" : "Addressof", "children" : [ { "name" : "Variable", "children" : [ { "name" : "p" }  ] }  ] }  ] }  ] }  ] }, { "name" : "VarDeclaration", "children" : [ { "name" : "Definedtype", "children" : [ { "name" : "Student" }  ] }, { "name" : "VarList", "children" : [ { "name" : "Varinit", "children" : [ { "name" : "s" }  ] }  ] }  ] }, { "name" : "VarDeclaration", "children" : [ { "name" : "PointerType", "children" : [ { "name" : "Definedtype", "children" : [ { "name" : "Student" }  ] }  ] }, { "name" : "VarList", "children" : [ { "name" : "Varinit", "children" : [ { "name" : "sp" }, { "name" : "Addressof", "children" : [ { "name" : "Variable", "children" : [ { "name" : "s" }  ] }  ] }  ] }  ] }  ] }, { "name" : "FunctionCall", "children" : [ { "name" : "Function Name", "children" : [ { "name" : "SetX" }  ] }, { "name" : "ArgList", "children" : [ { "name" : "Constant", "children" : [ { "name" : "37" }  ] }  ] }  ] }, { "name" : "VarDeclaration", "children" : [ { "name" : "BuildInType", "children" : [ { "name" : "Int" }  ] }, { "name" : "VarList", "children" : [ { "name" : "Varinit", "children" : [ { "name" : "x" }, { "name" : "FunctionCall", "children" : [ { "name" : "Function Name", "children" : [ { "name" : "GetX" }  ] }, { "name" : "ArgList", "children" : [  ] }  ] }  ] }  ] }  ] }, { "name" : "FunctionCall", "children" : [ { "name" : "Function Name", "children" : [ { "name" : "printf" }  ] }, { "name" : "ArgList", "children" : [ { "name" : "Global String", "children" : [ { "name" : "\"%d\\n\"" }  ] }, { "name" : "Variable", "children" : [ { "name" : "x" }  ] }  ] }  ] }, { "name" : "FunctionCall", "children" : [ { "name" : "Function Name", "children" : [ { "name" : "PrintX" }  ] }, { "name" : "ArgList", "children" : [  ] }  ] }, { "name" : "ReturnStmt", "children" : [ { "name" : "Constant", "children" : [ { "name" : "0" }  ] }  ] }  ] }  ] }  ] };
		//获取节点数组和连线数组
		var nodes = tree.nodes(root)//获取所有节点信息
		var links = tree.links(nodes)//获取节点的连线信息集合

		//生成连线
		var link = svg.selectAll('.link')
			.data(links)
			.enter()
			.append('path')
			.attr('class', 'link')
			.attr('d', diagonal)

		//生成节点
		var node = svg.selectAll('.node')
			.data(nodes)
			.enter()
			.append('g')
			.attr('class', 'node')
			.attr('transform', function (d) {
				return "translate(" + d.y + "," + d.x + ")";
			});

		//给节点添加圆圈设置半径 
		node.append('circle')
			.attr('r', 2);


		//给节点添加文本 设置文本样式 位置
		node.append("text")
			.attr("dx", function (d) { return 0; })//定义文本显示x轴偏移量
			.attr("dy", 5)//定义文本显示y轴偏移量
			.style("text-anchor", function (d) { return "middle"; })//文字对齐显示
			.attr('class', 'text')
			.text(function (d) { return d.name; });
	</script>
</body>

</html>
